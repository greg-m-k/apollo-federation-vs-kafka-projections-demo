# Apollo Router Configuration for Federation Demo

# Server configuration
supergraph:
  listen: 0.0.0.0:4000
  introspection: true

# CORS settings for dashboard access
cors:
  origins:
    - http://localhost:3000
    - http://localhost:8080
    - http://dashboard:8080
  allow_any_origin: true
  methods:
    - GET
    - POST
    - OPTIONS
  allow_headers:
    - Content-Type
    - Authorization
    - X-Apollo-Operation-Name
  expose_headers:
    - X-Subgraph-Time-Ms
    - X-Timing-Details
    - X-HR-Time-Ms
    - X-Employment-Time-Ms
    - X-Security-Time-Ms

# Sandbox for development
sandbox:
  enabled: true

# Homepage
homepage:
  enabled: false

# Health check endpoint
health_check:
  listen: 0.0.0.0:8088
  enabled: true

# Include subgraph errors in responses (for demo purposes)
include_subgraph_errors:
  all: true

# Traffic shaping for subgraphs
traffic_shaping:
  all:
    timeout: 30s
  subgraphs:
    hr:
      timeout: 10s
    employment:
      timeout: 10s
    security:
      timeout: 10s

# Headers to propagate to subgraphs
headers:
  all:
    request:
      - propagate:
          named: "X-Request-Id"
      - propagate:
          named: "X-Correlation-Id"

# Telemetry - expose subgraph timing in response extensions
telemetry:
  exporters:
    logging:
      stdout:
        enabled: true
        format: json
  instrumentation:
    spans:
      mode: spec_compliant
      subgraph:
        attributes:
          subgraph.name: true

# Include subgraph extensions (for timing data)
include_subgraph_extensions:
  all: true

# Expose timing in GraphQL extensions
plugins:
  experimental.expose_query_plan: true
